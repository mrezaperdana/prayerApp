<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Prayer App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let prayerTimes = {}; // global
        let monthlyCalendar = [];

        window.prayerChart = null;
        let calendarViewMode = "week"; // "week" or "month"
        let currentCalendarPage = 0;
        const calendarPageSize = 30; // still used for monthly chunking



    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .prayer-card {
            transition: all 0.3s ease;
        }

        .prayer-card:hover {
            transform: scale(1.03);
        }

        .dua-button {
            transition: all 0.2s ease;
        }

        .dua-button:hover {
            transform: translateY(-2px);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body class="bg-gray-50 font-sans">

    <div
        class="max-w-md mx-auto bg-cover bg-center bg-[url('https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/bg_fajr.jpg')] min-h-screen flex flex-col relative">


        <div class="absolute top-4 right-4 z-50 flex space-x-3 text-white mb-6">
            <button onclick="showScreen('notification-settings-modal')"
                class="bg-white/20 hover:bg-white/30 rounded-full w-10 h-10 flex items-center justify-center">
                <i class="fas fa-bell text-lg"></i>
            </button>
            <button onclick="showScreen('profile-screen')"
                class="bg-white/20 hover:bg-white/30 rounded-full w-10 h-10 flex items-center justify-center">
                <i class="fas fa-user text-lg"></i>
            </button>
        </div>

        <!-- Main Content -->

        <div class="flex-1 overflow-y-auto pb-20">

            <!-- Home Screen -->
            <div id="home-screen" class="p-4">
                <div class="bg-white/30 rounded-xl p-6 text-gray-900 shadow-lg mb-3 mt-12 text-center backdrop-blur-md">
                    <h1 id="current-prayer-name" class="text-2xl font-bold mb-1">Current Prayer</h1>
                    <p id="current-prayer-time" class="text-lg text-dark-600">00:00</p>
                    <p class="opacity-90">
                        <span id="current-date" class="font-medium"></span>
                    </p>
                </div>



                <div class="mb-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">
                        Today's Hadith
                    </h2>
                    <div class="bg-white/70 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                        <p class="text-gray-700 italic mb-2">
                            "The most beloved deed to Allah is the most regular and constant
                            even if it were little."
                        </p>
                        <p class="text-gray-600 text-sm">Sahih al-Bukhari 6464</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 ">
                    <!-- Next Prayer Button -->
                    <button
                        class="bg-white/30 p-4 rounded-lg flex flex-col justify-between items-center h-48 w-full shadow-md">
                        <!-- Title always at top -->
                        <div class="text-sm font-semibold">Next Prayer</div>

                        <!-- Countdown content -->
                        <div class="flex-grow flex flex-col justify-center items-center text-center text-sm"
                            id="next-prayer"></div>
                    </button>

                    <!-- Track Prayer Button -->
                    <button onclick="showScreen('prayer-screen')"
                        class="bg-white/30 p-4 rounded-lg flex flex-col justify-between items-center h-48 w-full shadow-md">
                        <!-- Title always at top -->
                        <div class="text-sm font-semibold">Track Prayer</div>

                        <!-- Chart in middle -->
                        <div class="flex-grow flex items-center justify-center">
                            <canvas id="myDonutChart" width="80" height="80"></canvas>
                        </div>

                        <!-- Bottom row -->
                        <div class="flex items-center space-x-2">
                            <span>Checkin</span>
                            <i class="fa-solid fa-arrow-right text-sm"></i>
                        </div>
                    </button>
                </div>


                <div class="mt-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">
                        Prayer Times
                    </h2>
                    <div id="prayer-times" class="grid grid-cols-2 gap-4">
                        <!-- Prayer times will be loaded here -->
                    </div>
                </div>

            </div>

            <!-- Prayer Times Screen -->
            <div id="prayer-screen" class="p-4 hidden">
                <div class="flex items-center mb-6">
                    <button onclick="showScreen('home-screen')" class="mr-4 text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">Prayer Times</h1>
                </div>


                <div class="grid grid-cols-2 gap-4 ">
                    <!-- Next Prayer Button -->
                    <button
                        class="bg-white/30 p-4 rounded-lg flex flex-col justify-between items-center h-48 w-full shadow-md">
                        <!-- Title always at top -->
                        <div class="text-sm font-semibold mb-6">Now</div>
                        <h1 id="now-prayer-name" class="text-2xl font-bold mb-1">now Prayer</h1>
                        <p id="now-prayer-time" class="text-lg text-dark-600">00:00</p>
                        <!-- Countdown content -->
                        <div class="flex-grow flex flex-col justify-center items-center text-center text-sm"
                            id="next-prayer"></div>
                    </button>

                    <!-- Track Prayer Button -->
                    <button onclick="showScreen('prayer-screen')"
                        class="bg-white/30 p-4 rounded-lg flex flex-col justify-between items-center h-48 w-full shadow-md">
                        <!-- Title always at top -->
                        <div class="text-sm font-semibold">Track Prayer</div>

                        <!-- Chart in middle -->
                        <div class="flex-grow flex items-center justify-center">
                            <canvas id="prayerDonutChart" width="80" height="80"></canvas>
                        </div>

                    
                    </button>
                </div>


                <div class="mt-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">
                        Prayer Times
                    </h2>
                    <div id="prayer-times" class="grid grid-cols-2 gap-4 ">
                        <!-- Prayer times will be loaded here -->
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="font-semibold text-gray-800" id="prayer-location">
                                Loading location...
                            </h2>
                            <p class="text-sm text-gray-500" id="prayer-hijri-date"></p>
                        </div>
                        <button onclick="showLocationSettings()" class="text-blue-500">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>


                    <div id="detailed-prayer-times">
                        <!-- Detailed prayer times will be loaded here -->
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <button onclick="markAllPrayers()" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Mark
                            All</button>
                        <button onclick="updatePrayerDonut()" class="bg-green-500 text-white px-4 py-2 rounded-lg">Check
                            In</button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="font-semibold text-gray-800 mb-4 text-center">Your Progress</h3>
                    <div id="prayer-calendar" class="text-center">
                        <p class="text-gray-500">Loading calendar...</p>
                    </div>
                </div>
            </div>

            <!-- Duas Screen -->
            <div id="duas-screen" class="p-4 hidden">
                <div class="flex items-center mb-6">
                    <button onclick="showScreen('home-screen')" class="mr-4 text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">Duas</h1>
                </div>

                <div class="flex mb-6 overflow-x-auto pb-2">
                    <button id="all-duas-tab" onclick="showDuaCategory('all')"
                        class="px-4 py-2 bg-blue-500 text-white rounded-full mr-2 whitespace-nowrap">
                        All Duas
                    </button>
                    <button id="favorite-duas-tab" onclick="showDuaCategory('favorites')"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full mr-2 whitespace-nowrap">
                        Favorites
                    </button>
                    <button id="custom-duas-tab" onclick="showDuaCategory('custom')"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full whitespace-nowrap">
                        My Duas
                    </button>
                </div>

                <div class="mb-4 relative">
                    <input type="text" id="dua-search" placeholder="Search duas..."
                        class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                </div>

                <!-- All Duas -->
                <div id="all-duas" class="space-y-3">
                    <!-- Duas will be loaded here -->
                </div>

                <!-- Favorite Duas -->
                <div id="favorite-duas" class="space-y-3 hidden">
                    <!-- Favorite duas will be loaded here -->
                </div>

                <!-- Custom Duas -->
                <div id="custom-duas" class="space-y-3 hidden">
                    <button onclick="showAddDuaModal()"
                        class="w-full p-4 bg-green-500 text-white rounded-lg flex items-center justify-center">
                        <i class="fas fa-plus mr-2"></i> Add New Dua
                    </button>
                    <div id="custom-duas-list">
                        <!-- Custom duas will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Tasbih Screen -->
            <div id="tasbih-screen" class="p-4 hidden">
                <div class="flex items-center mb-6">
                    <button onclick="showScreen('home-screen')" class="mr-4 text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">Tasbih Counter</h1>
                </div>



                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="font-semibold text-gray-800 mb-4">History</h3>
                    <div id="tasbih-history">
                        <!-- History will be loaded here -->
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 text-center">
                    <div class="text-6xl font-bold text-gray-800 mb-6" id="counter-display">
                        0
                    </div>
                    <div class="flex justify-center space-x-4 mb-6">

                        <button onclick="resetCounter()"
                            class="bg-gray-200 text-gray-800 w-16 h-16 rounded-full flex items-center justify-center text-2xl">
                            <i class="fas fa-redo"></i>
                        </button>
                        <button onclick="incrementCounter()"
                            class="bg-blue-500 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>

                    <div class="text-gray-600 mb-4">
                        Current Dhikr:
                        <span id="current-dhikr" class="font-medium">SubhanAllah</span>
                    </div>
                    <div class="flex justify-center space-x-2">
                        <button onclick="setDhikr('SubhanAllah')"
                            class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                            SubhanAllah
                        </button>
                        <button onclick="setDhikr('Alhamdulillah')"
                            class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">
                            Alhamdulillah
                        </button>
                        <button onclick="setDhikr('AllahuAkbar')"
                            class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm">
                            Allahu Akbar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Screen -->
            <div id="profile-screen" class="p-4 hidden">
                <div class="flex items-center mb-6">
                    <button onclick="showScreen('home-screen')" class="mr-4 text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">Profile</h1>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex items-center mb-4">
                        <div
                            class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-500 text-2xl mr-4">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h2 class="font-semibold text-gray-800" id="profile-name">
                                User
                            </h2>
                            <p class="text-gray-500 text-sm">
                                Member since <span id="member-since">2023</span>
                            </p>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <button onclick="showEditProfileModal()"
                            class="w-full p-3 bg-gray-100 rounded-lg flex items-center justify-between text-gray-700">
                            <span>Edit Profile</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button onclick="showLocationSettings()"
                            class="w-full p-3 bg-gray-100 rounded-lg flex items-center justify-between text-gray-700">
                            <span>Prayer Location</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                        <button onclick="showNotificationSettings()"
                            class="w-full p-3 bg-gray-100 rounded-lg flex items-center justify-between text-gray-700">
                            <span>Notifications</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="font-semibold text-gray-800 mb-4">App Settings</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700">Dark Mode</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle" class="sr-only peer" />
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700">Language</span>
                            <select id="language-select"
                                class="bg-gray-100 border border-gray-300 text-gray-700 rounded-lg px-3 py-1.5">
                                <option value="en">English</option>
                                <option value="ar">العربية</option>
                                <option value="ur">اردو</option>
                            </select>
                        </div>
                    </div>
                </div>

                <button onclick="showAboutApp()"
                    class="w-full p-3 bg-white rounded-xl shadow-md mb-6 text-left flex items-center justify-between text-gray-700">
                    <span>About App</span>
                    <i class="fas fa-chevron-right"></i>
                </button>

                <button onclick="logout()"
                    class="w-full p-3 bg-red-500 text-white rounded-lg flex items-center justify-center">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div
            class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 flex justify-around items-center h-16 max-w-md mx-auto">
            <button onclick="showScreen('home-screen')"
                class="flex flex-col items-center justify-center h-full text-blue-500">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Home</span>
            </button>
            <button onclick="showScreen('prayer-screen')"
                class="flex flex-col items-center justify-center h-full text-gray-500">
                <i class="fas fa-clock text-xl"></i>
                <span class="text-xs mt-1">Prayer</span>
            </button>
            <button onclick="showScreen('duas-screen')"
                class="flex flex-col items-center justify-center h-full text-gray-500">
                <i class="fas fa-hands-praying text-xl"></i>
                <span class="text-xs mt-1">Duas</span>
            </button>
            <button onclick="showScreen('tasbih-screen')"
                class="flex flex-col items-center justify-center h-full text-gray-500">
                <i class="fas fa-dharmachakra text-xl"></i>
                <span class="text-xs mt-1">Tasbih</span>
            </button>
            <button onclick="showScreen('profile-screen')"
                class="flex flex-col items-center justify-center h-full text-gray-500">
                <i class="fas fa-user text-xl"></i>
                <span class="text-xs mt-1">Profile</span>
            </button>
        </div>

        <!-- Modals -->

        <!-- Dua Detail Modal -->
        <div id="dua-detail-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md max-h-[80vh] overflow-y-auto slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800" id="dua-modal-title">
                            Dua Title
                        </h3>
                        <button onclick="closeModal('dua-detail-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-6">
                        <p class="text-gray-700 mb-4" id="dua-modal-content">
                            Dua content goes here...
                        </p>
                        <p class="text-gray-500 text-sm" id="dua-modal-reference">
                            Reference: Sahih Bukhari
                        </p>
                    </div>
                    <div class="flex justify-between items-center">
                        <button id="dua-favorite-btn" onclick="toggleFavoriteDua()"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg flex items-center">
                            <i class="far fa-heart mr-2"></i> Favorite
                        </button>
                        <button onclick="closeModal('dua-detail-modal')"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Dua Modal -->
        <div id="add-dua-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Add New Dua</h3>
                        <button onclick="closeModal('add-dua-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Title</label>
                        <input type="text" id="new-dua-title"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Content</label>
                        <textarea id="new-dua-content" rows="4"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal('add-dua-modal')"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">
                            Cancel
                        </button>
                        <button onclick="saveCustomDua()" class="px-4 py-2 bg-green-500 text-white rounded-lg">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Settings Modal -->
        <div id="location-settings-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Prayer Location</h3>
                        <button onclick="closeModal('location-settings-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Country</label>
                        <select id="country-select"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Country</option>
                            <option value="US">United States</option>
                            <option value="GB">United Kingdom</option>
                            <option value="SA">Saudi Arabia</option>
                            <option value="AE">United Arab Emirates</option>
                            <option value="PK">Pakistan</option>
                            <option value="IN">India</option>
                            <option value="MY">Malaysia</option>
                            <option value="ID">Indonesia</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">City</label>
                        <input type="text" id="city-input"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Calculation Method</label>
                        <select id="method-select"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="0">Shia Ithna-Ashari</option>
                            <option value="1">
                                University of Islamic Sciences, Karachi
                            </option>
                            <option value="2">Islamic Society of North America</option>
                            <option value="3">Muslim World League</option>
                            <option value="4">Umm al-Qura, Makkah</option>
                            <option value="5">Egyptian General Authority of Survey</option>
                            <option value="7">
                                Institute of Geophysics, University of Tehran
                            </option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal('location-settings-modal')"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">
                            Cancel
                        </button>
                        <button onclick="saveLocationSettings()" class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="edit-profile-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Edit Profile</h3>
                        <button onclick="closeModal('edit-profile-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Name</label>
                        <input type="text" id="profile-name-input"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input type="email" id="profile-email-input"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal('edit-profile-modal')"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">
                            Cancel
                        </button>
                        <button onclick="saveProfile()" class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Settings Modal -->
        <div id="notification-settings-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            Notification Settings
                        </h3>
                        <button onclick="closeModal('notification-settings-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">
                                    Prayer Time Notifications
                                </h4>
                                <p class="text-sm text-gray-500">
                                    Get notified before each prayer time
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="prayer-notifications-toggle" class="sr-only peer" checked />
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">
                                    Reminder Notifications
                                </h4>
                                <p class="text-sm text-gray-500">
                                    Daily reminders for morning and evening adhkar
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="reminder-notifications-toggle" class="sr-only peer"
                                    checked />
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">Friday Reminder</h4>
                                <p class="text-sm text-gray-500">
                                    Weekly reminder for Jummah prayer
                                </p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="friday-notifications-toggle" class="sr-only peer" checked />
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button onclick="saveNotificationSettings()"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- About App Modal -->
        <div id="about-app-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white rounded-xl w-full max-w-md slide-up">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            About My Prayer App
                        </h3>
                        <button onclick="closeModal('about-app-modal')" class="text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-6">
                        <div class="flex items-center justify-center mb-6">
                            <div
                                class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center text-blue-500 text-3xl mr-4">
                                <i class="fas fa-mosque"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg">My Prayer App</h4>
                                <p class="text-gray-500">Version 1.0.0</p>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">
                            My Prayer App is designed to help Muslims keep track of their
                            daily prayers, duas, and dhikr. With accurate prayer times, a
                            comprehensive dua collection, and a digital tasbih counter, it's
                            your perfect companion for daily worship.
                        </p>
                        <p class="text-gray-700">
                            May this app help you strengthen your connection with Allah and
                            make your worship more meaningful.
                        </p>
                    </div>
                    <div class="flex justify-center">
                        <button onclick="closeModal('about-app-modal')"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateNowPrayer() {
            const now = new Date();
            const times = prayerTimes;
            const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            let current = "";
            let currentTime = "";

            for (let i = 0; i < prayers.length; i++) {
                const prayer = prayers[i];
                const timeStr = times[prayer];
                const [h, m] = timeStr.split(":").map(Number);
                const prayerTime = new Date();
                prayerTime.setHours(h, m, 0, 0);

                if (now >= prayerTime) {
                    current = prayer;
                    currentTime = timeStr;
                }
            }

            // If no past prayer found, assume Fajr (e.g., early morning)
            if (!current) {
                current = "Fajr";
                currentTime = times["Fajr"];
            }

            document.getElementById("now-prayer-name").textContent = current;
            document.getElementById("now-prayer-time").textContent = currentTime;
        }

        function updateCurrentPrayer() {
            const now = new Date();
            const times = prayerTimes;
            const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            let current = "";
            let currentTime = "";

            for (let i = 0; i < prayers.length; i++) {
                const prayer = prayers[i];
                const timeStr = times[prayer];
                const [h, m] = timeStr.split(":").map(Number);
                const prayerTime = new Date();
                prayerTime.setHours(h, m, 0, 0);

                if (now >= prayerTime) {
                    current = prayer;
                    currentTime = timeStr;
                }
            }

            // If no past prayer found, assume Fajr (e.g., early morning)
            if (!current) {
                current = "Fajr";
                currentTime = times["Fajr"];
            }

            document.getElementById("current-prayer-name").textContent = current;
            document.getElementById("current-prayer-time").textContent = currentTime;
        }
        // Update every minute
        setInterval(updateCurrentPrayer, 60000);
        document.addEventListener("DOMContentLoaded", () => {
            updateCurrentPrayer();
        });


        function getNextPrayer(prayerTimes) {
            const now = new Date();
            const todayStr = now.toISOString().split("T")[0];

            const orderedPrayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];

            for (let prayer of orderedPrayers) {
                const timeStr = prayerTimes[prayer];
                if (!timeStr) continue;

                const [hours, minutes] = timeStr.split(":");
                const time = new Date(todayStr + "T" + timeStr.padStart(5, "0"));

                if (now < time) {
                    return { name: prayer, time };
                }
            }

            // All prayers have passed → fallback to tomorrow’s Fajr
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(...prayerTimes["Fajr"].split(":").map(Number), 0, 0);
            return { name: "Fajr (Tomorrow)", time: tomorrow };
        }

        function updateNextPrayerCountdown() {
            const container = document.getElementById("next-prayer");
            if (!container || !prayerTimes) return;

            const { name: nextName, time: nextTime } = getNextPrayer(prayerTimes);
            const now = new Date();
            const diff = nextTime - now;

            if (diff <= 0) {
                container.innerHTML = `<div class="text-center text-sm">Loading...</div>`;
                return;
            }

            const hours = String(Math.floor(diff / (1000 * 60 * 60))).padStart(2, "0");
            const mins = String(Math.floor((diff / (1000 * 60)) % 60)).padStart(2, "0");
            const secs = String(Math.floor((diff / 1000) % 60)).padStart(2, "0");

            // ⬇️ Update countdown section
            container.innerHTML =

                `
      <div class="text-lg font-semibold text-black-600">${nextName}</div>
      <div class="text-sm text-black-700">${nextTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
      <div class="text-sm font-mono text-black-500">-${hours}:${mins}:${secs}</div>

  `;

            // ⬇️ Determine current prayer (the one just before next prayer)
            const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            let currentPrayer = "";
            let currentTime = "";

            for (let i = 0; i < prayers.length; i++) {
                const prayer = prayers[i];
                const [h, m] = prayerTimes[prayer].split(":").map(Number);
                const prayerDate = new Date();
                prayerDate.setHours(h, m, 0, 0);

                if (now >= prayerDate) {
                    currentPrayer = prayer;
                    currentTime = prayerTimes[prayer];
                }
            }

            if (!currentPrayer) {
                currentPrayer = "Fajr"; // fallback for early morning
                currentTime = prayerTimes["Fajr"];
            }

            // ⬇️ Update the current prayer display
            const nameEl = document.getElementById("current-prayer-name");
            const timeEl = document.getElementById("current-prayer-time");

            if (nameEl && timeEl) {
                nameEl.textContent = currentPrayer;
                timeEl.textContent = currentTime;
            }

            // ⬇️ Highlight the current prayer row in blue
            const prayerElements = document.querySelectorAll("[id^='prayer-']");
            prayerElements.forEach((el) => {
                el.classList.remove("text-blue-400", "font-bold");
            });
            const currentEl = document.getElementById(`prayer-${currentPrayer}`);
            if (currentEl) {
                currentEl.classList.add("text-blue-400", "font-bold");
            }
        }


        const centerTextPlugin = {
            id: "centerText",
            beforeDraw(chart) {
                const { width, height, ctx } = chart;
                const text = "1/5";

                ctx.save();
                ctx.font = "bold 18px sans-serif";
                ctx.fillStyle = "#1F2937"; // Tailwind gray-800
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(text, width / 2, height / 2);
                ctx.restore();
            },
        };



        // Sample data for duas
        const duas = [
            {
                id: 1,
                title: "Morning",
                content:
                    "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذَا الْيَوْمِ وَخَيْرَ مَا بَعْدَهُ، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذَا الْيَوْمِ وَشَرِّ مَا بَعْدَهُ، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ",
                reference: "Muslim 4/2088",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/after_salah.jpg",
            },
            {
                id: 2,
                title: "Evening",
                content:
                    "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذِهِ اللَّيْلَةِ وَخَيْرَ مَا بَعْدَهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذِهِ اللَّيْلَةِ وَشَرِّ مَا بَعْدَهَا، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ",
                reference: "Muslim 4/2088",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/before_sleep.jpg",
            },
            {
                id: 3,
                title: "Before Sleeping",
                content:
                    "بِاسْمِكَ رَبِّي وَضَعْتُ جَنْبِي، وَبِكَ أَرْفَعُهُ، فَإِنْ أَمْسَكْتَ نَفْسِي فَارْحَمْهَا، وَإِنْ أَرْسَلْتَهَا فَاحْفَظْهَا بِمَا تَحْفَظُ بِهِ عِبَادَكَ الصَّالِحِينَ",
                reference: "Bukhari 11/126",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/dhikr.jpg",
            },
            {
                id: 4,
                title: "After Waking Up",
                content:
                    "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ",
                reference: "Bukhari 11/126",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/istighfar.jpg",
            },
            {
                id: 5,
                title: "Before Eating",
                content: "بِسْمِ اللَّهِ وَعَلَى بَرَكَةِ اللَّهِ",
                reference: "Abu Dawud 3/347",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/morning.jpg",
            },
            {
                id: 6,
                title: "After Eating",
                content:
                    "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنَا وَسَقَانَا وَجَعَلَنَا مُسْلِمِينَ",
                reference: "Tirmidhi 5/506",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/ruqyah.jpg",
            },
            {
                id: 7,
                title: "When Entering the Mosque",
                content:
                    "أَعُوذُ بِاللَّهِ الْعَظِيمِ وَبِوَجْهِهِ الْكَرِيمِ وَسُلْطَانِهِ الْقَدِيمِ مِنَ الشَّيْطَانِ الرَّجِيمِ",
                reference: "Abu Dawud 1/123",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/salah.jpg",
            },
            {
                id: 8,
                title: "When Leaving the Mosque",
                content: "اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ",
                reference: "Muslim 2/155",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/salawat.jpg",
            },
            {
                id: 9,
                title: "Anxiety",
                content:
                    "اللَّهُمَّ إِنِّي عَبْدُكَ وَابْنُ عَبْدِكَ وَابْنُ أَمَتِكَ نَاصِيَتِي بِيَدِكَ مَاضٍ فِيَّ حُكْمُكَ عَدْلٌ فِيَّ قَضَاؤُكَ أَسْأَلُكَ بِكُلِّ اسْمٍ هُوَ لَكَ سَمَّيْتَ بِهِ نَفْسَكَ أَوْ أَنْزَلْتَهُ فِي كِتَابِكَ أَوْ عَلَّمْتَهُ أَحَدًا مِنْ خَلْقِكَ أَوِ اسْتَأْثَرْتَ بِهِ فِي عِلْمِ الْغَيْبِ عِنْدَكَ أَنْ تَجْعَلَ الْقُرْآنَ رَبِيعَ قَلْبِي وَنُورَ صَدْرِي وَجَلَاءَ حُزْنِي وَذَهَابَ هَمِّي",
                reference: "Ahmad 1/391",
                isFavorite: false,
                image:
                    "https://raw.githubusercontent.com/mrezaperdana/prayerApp/main/assets/sunnah.jpg",
            },

        ];

        async function fetchTodayPrayerTimes() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, "0");
            const dd = String(today.getDate()).padStart(2, "0");

            const response = await fetch(
                `https://api.aladhan.com/v1/timingsByCity/${dd}-${mm}-${yyyy}?city=Jakarta&country=Indonesia&method=2`
            );
            const data = await response.json();

            const timings = data.data.timings;

            const prayerTimes = {
                Fajr: timings.Fajr,
                Sunrise: timings.Sunrise,
                Dhuhr: timings.Dhuhr,
                Asr: timings.Asr,
                Maghrib: timings.Maghrib,
                Isha: timings.Isha,
            };

            return prayerTimes;
        }

        async function fetchMonthlyPrayerCalendar() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();

            const response = await fetch(
                `https://api.aladhan.com/v1/calendarByCity?city=Jakarta&country=Indonesia&method=2&month=${month}&year=${year}`
            );
            const data = await response.json();

            const calendarData = data.data;

            const monthlyCalendar = calendarData.map((day) => {
                const gregorian = day.date.gregorian;
                const timings = day.timings;
                return {
                    date: gregorian.day,
                    day: gregorian.weekday.en,
                    fajr: timings.Fajr.split(" ")[0],
                    dhuhr: timings.Dhuhr.split(" ")[0],
                    asr: timings.Asr.split(" ")[0],
                    maghrib: timings.Maghrib.split(" ")[0],
                    isha: timings.Isha.split(" ")[0],
                };
            });

            return monthlyCalendar;
        }

        document.addEventListener("DOMContentLoaded", async function () {
            prayerTimes = await fetchTodayPrayerTimes(); // no const
            setInterval(updateNextPrayerCountdown, 1000);
            updateNextPrayerCountdown();

            monthlyCalendar = await fetchMonthlyPrayerCalendar();

            // Now use prayerTimes and monthlyCalendar to render your UI
            loadPrayerTimes();
            loadDetailedPrayerTimes();
            loadPrayerCalendar();
        });

        // Sample tasbih history
        const tasbihHistory = [
            { date: "Today", dhikr: "SubhanAllah", count: 33 },
            { date: "Yesterday", dhikr: "Alhamdulillah", count: 33 },
            { date: "Jun 10", dhikr: "Allahu Akbar", count: 34 },
        ];

        // Current user data
        let userData = {
            name: "User",
            email: "user@example.com",
            memberSince: "2023",
            location: {
                country: "US",
                city: "New York",
                method: "2",
            },
            notifications: {
                prayer: true,
                reminder: true,
                friday: true,
            },
            darkMode: false,
            language: "en",
        };

        // Current tasbih counter
        let counter = 0;
        let currentDhikr = "SubhanAllah";
        let customDuas = [];

        // Initialize the app
        document.addEventListener("DOMContentLoaded", async function () {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, "0");
            const dd = String(today.getDate()).padStart(2, "0");

            // Fetch prayer times and assign to global variables
            prayerTimes = await fetchTodayPrayerTimes();
            monthlyCalendar = await fetchMonthlyPrayerCalendar();

            // Set combined Gregorian and Hijri date
            const gregorianDate = today.toLocaleDateString("en-US", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
            });

            const hijriFormatter = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
                weekday: "long",
                day: "numeric",
                month: "long",
                year: "numeric",
            });
            const hijriDate = hijriFormatter.format(today);

            document.getElementById(
                "current-date"
            ).textContent = `${gregorianDate} / ${hijriDate}`;
            document.getElementById("prayer-hijri-date").textContent = hijriDate;

            // Load everything
            loadPrayerTimes();
            loadDetailedPrayerTimes();
            loadPrayerCalendar();
            loadDuas();
            loadCustomDuas();
            loadTasbihHistory();
            loadUserProfile();
            setActiveNav("home");
            loadUserPreferences();
            updatePrayerDonut();
        });

        // Show screen function
        // Show screen function
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('[id$="-screen"]').forEach((screen) => {
                screen.classList.add("hidden");
            });

            // Show the selected screen
            document.getElementById(screenId).classList.remove("hidden");

            // Update active nav
            const navId = screenId.split("-")[0];
            setActiveNav(navId);

            // Refresh content if needed
            if (screenId === "prayer-screen") {
                loadDetailedPrayerTimes();
                loadPrayerCalendar();
                updatePrayerDonut();
                updateNowPrayer();
            } else if (screenId === "duas-screen") {
                loadDuas();
            } else if (screenId === "tasbih-screen") {
                updateCounterDisplay();
            } else if (screenId === "home-screen") {
                updatePrayerDonut();
            }
        }

        // Set active nav
        function setActiveNav(navId) {
            // Reset all nav items
            document.querySelectorAll(".bottom-nav button").forEach((btn) => {
                btn.classList.remove("text-blue-500");
                btn.classList.add("text-gray-500");
            });

            // Set active nav item
            const activeBtn = document.querySelector(
                `.bottom-nav button[onclick="showScreen('${navId}-screen')"]`
            );
            if (activeBtn) {
                activeBtn.classList.remove("text-gray-500");
                activeBtn.classList.add("text-blue-500");
            }
        }

        // Load prayer times
        function loadPrayerTimes() {
            const container = document.getElementById("prayer-times");
            container.innerHTML = "";

            const now = new Date();
            const todayStr = now.toISOString().split("T")[0];
            let activePrayer = null;

            const prayers = Object.entries(prayerTimes).map(([name, time]) => {
                const [hours, minutes] = time.split(":");
                const prayerTime = new Date(todayStr + "T" + time.padStart(5, "0"));
                return { name, time, date: prayerTime };
            });

            for (let i = prayers.length - 1; i >= 0; i--) {
                if (now >= prayers[i].date) {
                    activePrayer = prayers[i].name;
                    break;
                }
            }

            for (const { name, time } of prayers) {
                const card = document.createElement("div");
                const isActive = name === activePrayer;
                card.className = `rounded-lg p-4 text-center prayer-card ${isActive ? "bg-blue-100 border border-blue-500" : "bg-white"
                    }`;

                const title = document.createElement("h3");
                title.className = `font-semibold ${isActive ? "text-blue-700" : "text-gray-800"
                    } mb-1`;
                title.textContent = name;

                const timeEl = document.createElement("p");
                timeEl.className = "text-dark-500 font-bold text-lg";
                timeEl.textContent = time;

                card.appendChild(title);
                card.appendChild(timeEl);
                container.appendChild(card);
            }
        }
        function markAllPrayers() {
            const todayKey = new Date().toISOString().split("T")[0];
            const checkedData = JSON.parse(localStorage.getItem("prayerCheckmarks")) || {};
            checkedData[todayKey] = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            localStorage.setItem("prayerCheckmarks", JSON.stringify(checkedData));
            loadDetailedPrayerTimes();
            updatePrayerDonut();
        }
        function markAllPrayers() {
            const todayKey = new Date().toISOString().split("T")[0];
            const checkedData = JSON.parse(localStorage.getItem("prayerCheckmarks")) || {};
            checkedData[todayKey] = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            localStorage.setItem("prayerCheckmarks", JSON.stringify(checkedData));
            loadDetailedPrayerTimes();
            updatePrayerDonut();
        }

        // Load detailed prayer times
        function loadDetailedPrayerTimes() {
            const container = document.getElementById("detailed-prayer-times");
            container.innerHTML = "";

            const todayKey = new Date().toISOString().split("T")[0];
            const checkedData = JSON.parse(localStorage.getItem("prayerCheckmarks")) || {};
            const todayChecks = checkedData[todayKey] || [];

            ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].forEach((prayer) => {
                const prayerItem = document.createElement("div");
                prayerItem.className = "flex items-center justify-between py-3 border-b border-gray-100";

                const left = document.createElement("div");
                left.className = "flex items-center space-x-3";

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.className = "form-checkbox h-5 w-5 text-blue-600";
                checkbox.checked = todayChecks.includes(prayer);

                checkbox.onchange = () => {
                    const updated = new Set(todayChecks);
                    if (checkbox.checked) {
                        updated.add(prayer);
                    } else {
                        updated.delete(prayer);
                    }
                    checkedData[todayKey] = [...updated];
                    localStorage.setItem("prayerCheckmarks", JSON.stringify(checkedData));
                    updatePrayerDonut(); // update the chart in home
                };

                const prayerName = document.createElement("span");
                prayerName.className = "font-medium text-gray-800";
                prayerName.textContent = prayer;

                left.appendChild(checkbox);
                left.appendChild(prayerName);

                const prayerTime = document.createElement("span");
                prayerTime.className = "font-bold text-gray-800";
                prayerTime.textContent = prayerTimes[prayer];

                prayerItem.appendChild(left);
                prayerItem.appendChild(prayerTime);
                container.appendChild(prayerItem);
            });
        }

        function updatePrayerDonut() {
            const todayKey = new Date().toISOString().split("T")[0];
            const checkmarks = JSON.parse(localStorage.getItem("prayerCheckmarks")) || {};
            const completed = (checkmarks[todayKey] || []).length;
            const total = 5;

            const centerTextPlugin = {
                id: 'centerText',
                beforeDraw(chart) {
                    const { width, height, ctx } = chart;
                    const text = `${completed}/${total}`;
                    ctx.save();
                    ctx.font = 'bold 18px sans-serif';
                    ctx.fillStyle = '#1F2937';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(text, width / 2, height / 2);
                    ctx.restore();
                }
            };

            function getChartConfig() {
                return {
                    type: "doughnut",
                    data: {
                        labels: ["Completed", "Remaining"],
                        datasets: [{
                            data: [completed, total - completed],
                            backgroundColor: ["#387f75", "#7bbcb6"],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        cutout: "70%",
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    },
                    plugins: [centerTextPlugin]
                };
            }

            // 🟢 Home screen chart
            const homeCtx = document.getElementById("myDonutChart")?.getContext("2d");
            if (homeCtx) {
                if (window.homePrayerChart) window.homePrayerChart.destroy();
                window.homePrayerChart = new Chart(homeCtx, getChartConfig());
            }

            // 🟣 Prayer screen chart
            const prayerCtx = document.getElementById("prayerDonutChart")?.getContext("2d");
            if (prayerCtx) {
                if (window.prayerScreenChart) window.prayerScreenChart.destroy();
                window.prayerScreenChart = new Chart(prayerCtx, getChartConfig());
            }
        }

        // Load prayer calendar
        function loadPrayerCalendar() {
            const container = document.getElementById("prayer-calendar");
            container.innerHTML = "";

            if (!monthlyCalendar || monthlyCalendar.length === 0) return;

            const mode = calendarViewMode || "week"; // "week" or "month"
            const startIndex = mode === "week" ? currentCalendarPage * 7 : currentCalendarPage * calendarPageSize;
            const count = mode === "week" ? 7 : calendarPageSize;

            const pageData = monthlyCalendar.slice(startIndex, startIndex + count);

            // Create table
            const table = document.createElement("table");
            table.className = "w-full text-center";

            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");
            headerRow.className = "bg-gray-100";

            // Header: Dates
            pageData.forEach((day) => {
                const th = document.createElement("th");
                th.className = "py-2 px-1 text-sm font-medium text-gray-700";
                th.textContent = `${day.day.slice(0, 3)}, ${day.date}`;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Body: Progress row only
            const tbody = document.createElement("tbody");
            const progressRow = document.createElement("tr");

            pageData.forEach(() => {
                const td = document.createElement("td");
                const randomDone = Math.floor(Math.random() * 5) + 1; // Demo
                td.textContent = `${randomDone}/5`;
                td.className = "py-2 px-1 text-sm text-gray-800 font-semibold";
                progressRow.appendChild(td);
            });

            tbody.appendChild(progressRow);
            table.appendChild(tbody);
            container.appendChild(table);

            // Toggle buttons
            const toggleControls = document.createElement("div");
            toggleControls.className = "flex justify-center items-center gap-2 mt-4";

            ["week", "month"].forEach((modeName) => {
                const btn = document.createElement("button");
                btn.textContent = modeName.charAt(0).toUpperCase() + modeName.slice(1);
                btn.className =
                    `px-3 py-1 rounded ${calendarViewMode === modeName ? "bg-blue-500 text-white" : "bg-gray-200 text-gray-700"}`;
                btn.onclick = () => {
                    calendarViewMode = modeName;
                    currentCalendarPage = 0;
                    loadPrayerCalendar();
                };

            });

            container.appendChild(toggleControls);

            // Pagination
            const totalPages = Math.ceil(monthlyCalendar.length / (mode === "week" ? 7 : calendarPageSize));
            const controls = document.createElement("div");
            controls.className = "flex justify-center items-center space-x-2 mt-2";

            if (currentCalendarPage > 0) {
                const prevBtn = document.createElement("button");
                prevBtn.textContent = "Prev";
                prevBtn.className = "px-3 py-1 bg-gray-200 rounded";
                prevBtn.onclick = () => {
                    currentCalendarPage--;
                    loadPrayerCalendar();
                };
                controls.appendChild(prevBtn);
            }

            for (let i = 0; i < totalPages; i++) {
                const pageBtn = document.createElement("button");
                pageBtn.textContent = (i + 1).toString();
                pageBtn.className = `px-3 py-1 rounded ${i === currentCalendarPage
                    ? "bg-blue-500 text-white font-bold"
                    : "bg-gray-200 text-gray-800"
                    }`;
                pageBtn.onclick = () => {
                    currentCalendarPage = i;
                    loadPrayerCalendar();
                };
                controls.appendChild(pageBtn);
            }

            if (currentCalendarPage < totalPages - 1) {
                const nextBtn = document.createElement("button");
                nextBtn.textContent = "Next";
                nextBtn.className = "px-3 py-1 bg-gray-200 rounded";
                nextBtn.onclick = () => {
                    currentCalendarPage++;
                    loadPrayerCalendar();
                };
                controls.appendChild(nextBtn);
            }

            container.appendChild(controls);
        }

        // Load duas
        function loadDuas() {
            const container = document.getElementById("all-duas");
            container.innerHTML = "";

            duas.forEach((dua) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 rounded-lg shadow-sm text-left dua-button flex justify-between items-center bg-cover bg-center relative overflow-hidden";
                duaButton.onclick = () => showDuaDetail(dua.id);

                // Set background image
                if (dua.image) {
                    duaButton.style.backgroundImage = `url('${dua.image}')`;
                } else {
                    duaButton.classList.add("bg-white"); // fallback background if no image
                }

                // Optional: add a dark overlay to improve text readability
                const overlay = document.createElement("div");
                overlay.className = "absolute inset-0 bg-black bg-opacity-40";
                duaButton.appendChild(overlay);

                // Text content (on top of image)
                const contentWrapper = document.createElement("div");
                contentWrapper.className =
                    "relative z-10 flex justify-between w-full items-center";

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-semibold text-white";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-white";

                contentWrapper.appendChild(duaTitle);
                contentWrapper.appendChild(icon);
                duaButton.appendChild(contentWrapper);
                container.appendChild(duaButton);
            });
        }

        // Show dua category
        function showDuaCategory(category) {
            // Reset all tabs
            document
                .getElementById("all-duas-tab")
                .classList.remove("bg-blue-500", "text-white");
            document
                .getElementById("all-duas-tab")
                .classList.add("bg-gray-200", "text-gray-700");
            document
                .getElementById("favorite-duas-tab")
                .classList.remove("bg-blue-500", "text-white");
            document
                .getElementById("favorite-duas-tab")
                .classList.add("bg-gray-200", "text-gray-700");
            document
                .getElementById("custom-duas-tab")
                .classList.remove("bg-blue-500", "text-white");
            document
                .getElementById("custom-duas-tab")
                .classList.add("bg-gray-200", "text-gray-700");

            // Hide all categories
            document.getElementById("all-duas").classList.add("hidden");
            document.getElementById("favorite-duas").classList.add("hidden");
            document.getElementById("custom-duas").classList.add("hidden");

            // Activate selected tab and show category
            if (category === "all") {
                document
                    .getElementById("all-duas-tab")
                    .classList.remove("bg-gray-200", "text-gray-700");
                document
                    .getElementById("all-duas-tab")
                    .classList.add("bg-blue-500", "text-white");
                document.getElementById("all-duas").classList.remove("hidden");
            } else if (category === "favorites") {
                document
                    .getElementById("favorite-duas-tab")
                    .classList.remove("bg-gray-200", "text-gray-700");
                document
                    .getElementById("favorite-duas-tab")
                    .classList.add("bg-blue-500", "text-white");
                document.getElementById("favorite-duas").classList.remove("hidden");
                loadFavoriteDuas();
            } else if (category === "custom") {
                document
                    .getElementById("custom-duas-tab")
                    .classList.remove("bg-gray-200", "text-gray-700");
                document
                    .getElementById("custom-duas-tab")
                    .classList.add("bg-blue-500", "text-white");
                document.getElementById("custom-duas").classList.remove("hidden");
                loadCustomDuasList();
            }
        }

        // Load favorite duas
        function loadFavoriteDuas() {
            const container = document.getElementById("favorite-duas");
            container.innerHTML = "";

            const favoriteDuas = duas.filter((dua) => dua.isFavorite);

            if (favoriteDuas.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.className = "text-center py-8 text-gray-500";
                emptyMessage.innerHTML =
                    '<i class="fas fa-heart text-3xl mb-2 text-gray-300"></i><p>No favorite duas yet</p>';
                container.appendChild(emptyMessage);
                return;
            }

            favoriteDuas.forEach((dua) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 rounded-lg shadow-sm text-left dua-button flex justify-between items-center bg-cover bg-center relative overflow-hidden";
                duaButton.onclick = () => showDuaDetail(dua.id);

                // Set background image
                if (dua.image) {
                    duaButton.style.backgroundImage = `url('${dua.image}')`;
                } else {
                    duaButton.classList.add("bg-white"); // fallback background if no image
                }

                // Optional: add a dark overlay to improve text readability
                const overlay = document.createElement("div");
                overlay.className = "absolute inset-0 bg-black bg-opacity-40";
                duaButton.appendChild(overlay);

                // Text content (on top of image)
                const contentWrapper = document.createElement("div");
                contentWrapper.className =
                    "relative z-10 flex justify-between w-full items-center";

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-semibold text-white";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-white";

                contentWrapper.appendChild(duaTitle);
                contentWrapper.appendChild(icon);
                duaButton.appendChild(contentWrapper);
                container.appendChild(duaButton);
            });
        }

        // Load custom duas list
        function loadCustomDuasList() {
            const container = document.getElementById("custom-duas-list");
            container.innerHTML = "";

            if (customDuas.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.className = "text-center py-8 text-gray-500";
                emptyMessage.innerHTML =
                    '<i class="fas fa-edit text-3xl mb-2 text-gray-300"></i><p>No custom duas yet</p>';
                container.appendChild(emptyMessage);
                return;
            }

            customDuas.forEach((dua, index) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 bg-white rounded-lg shadow-sm text-left dua-button flex justify-between items-center mt-3";
                duaButton.onclick = () => showCustomDuaDetail(index);

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-medium text-gray-800";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-gray-400";

                duaButton.appendChild(duaTitle);
                duaButton.appendChild(icon);
                container.appendChild(duaButton);
            });
        }

        // Show dua detail
        function showDuaDetail(duaId) {
            const dua = duas.find((d) => d.id === duaId);
            if (!dua) return;

            document.getElementById("dua-modal-title").textContent = dua.title;
            document.getElementById("dua-modal-content").textContent = dua.content;
            document.getElementById(
                "dua-modal-reference"
            ).textContent = `Reference: ${dua.reference}`;

            const favoriteBtn = document.getElementById("dua-favorite-btn");
            if (dua.isFavorite) {
                favoriteBtn.innerHTML =
                    '<i class="fas fa-heart mr-2 text-red-500"></i> Remove Favorite';
                favoriteBtn.classList.remove("bg-gray-200");
                favoriteBtn.classList.add("bg-red-100", "text-red-700");
            } else {
                favoriteBtn.innerHTML = '<i class="far fa-heart mr-2"></i> Favorite';
                favoriteBtn.classList.remove("bg-red-100", "text-red-700");
                favoriteBtn.classList.add("bg-gray-200", "text-gray-700");
            }

            // Store current dua ID in the button for toggleFavoriteDua function
            favoriteBtn.setAttribute("data-dua-id", duaId);

            showModal("dua-detail-modal");
        }

        // Show custom dua detail
        function showCustomDuaDetail(duaIndex) {
            const dua = customDuas[duaIndex];
            if (!dua) return;

            document.getElementById("dua-modal-title").textContent = dua.title;
            document.getElementById("dua-modal-content").textContent = dua.content;
            document.getElementById("dua-modal-reference").textContent =
                "My Personal Dua";

            const favoriteBtn = document.getElementById("dua-favorite-btn");
            favoriteBtn.classList.add("hidden");

            showModal("dua-detail-modal");
        }

        // Toggle favorite dua
        function toggleFavoriteDua() {
            const favoriteBtn = document.getElementById("dua-favorite-btn");
            const duaId = parseInt(favoriteBtn.getAttribute("data-dua-id"));
            const duaIndex = duas.findIndex((d) => d.id === duaId);

            if (duaIndex !== -1) {
                duas[duaIndex].isFavorite = !duas[duaIndex].isFavorite;

                if (duas[duaIndex].isFavorite) {
                    favoriteBtn.innerHTML =
                        '<i class="fas fa-heart mr-2 text-red-500"></i> Remove Favorite';
                    favoriteBtn.classList.remove("bg-gray-200");
                    favoriteBtn.classList.add("bg-red-100", "text-red-700");
                } else {
                    favoriteBtn.innerHTML =
                        '<i class="far fa-heart mr-2"></i> Favorite';
                    favoriteBtn.classList.remove("bg-red-100", "text-red-700");
                    favoriteBtn.classList.add("bg-gray-200", "text-gray-700");
                }

                // Update favorite duas list if it's visible
                if (
                    !document
                        .getElementById("favorite-duas")
                        .classList.contains("hidden")
                ) {
                    loadFavoriteDuas();
                }
            }
        }

        // Show add dua modal
        function showAddDuaModal() {
            document.getElementById("new-dua-title").value = "";
            document.getElementById("new-dua-content").value = "";
            showModal("add-dua-modal");
        }

        // Save custom dua
        function saveCustomDua() {
            const title = document.getElementById("new-dua-title").value.trim();
            const content = document.getElementById("new-dua-content").value.trim();

            if (!title || !content) {
                alert("Please fill in both title and content");
                return;
            }

            const newDua = {
                id: Date.now(), // Use timestamp as ID
                title: title,
                content: content,
            };

            customDuas.push(newDua);
            saveCustomDuasToStorage();
            loadCustomDuasList();
            closeModal("add-dua-modal");
        }

        // Save custom duas to localStorage
        function saveCustomDuasToStorage() {
            localStorage.setItem("customDuas", JSON.stringify(customDuas));
        }

        // Load custom duas from localStorage
        function loadCustomDuas() {
            const savedDuas = localStorage.getItem("customDuas");
            if (savedDuas) {
                customDuas = JSON.parse(savedDuas);
            }
        }

        // Tasbih counter functions
        function incrementCounter() {
            counter++;
            updateCounterDisplay();
        }

        function resetCounter() {
            if (counter > 0) {
                // Save to history before resetting
                saveTasbihHistory();
                counter = 0;
                updateCounterDisplay();
            }
        }

        function setDhikr(dhikr) {
            currentDhikr = dhikr;
            document.getElementById("current-dhikr").textContent = dhikr;
        }

        function updateCounterDisplay() {
            document.getElementById("counter-display").textContent = counter;
        }

        // Save tasbih history
        function saveTasbihHistory() {
            const now = new Date();
            const dateStr = now.toLocaleDateString("en-US", {
                month: "short",
                day: "numeric",
            });

            tasbihHistory.unshift({
                date: dateStr,
                dhikr: currentDhikr,
                count: counter,
            });

            // Keep only last 10 items
            if (tasbihHistory.length > 10) {
                tasbihHistory.pop();
            }

            // Update history display
            loadTasbihHistory();
        }

        // Load tasbih history
        function loadTasbihHistory() {
            const container = document.getElementById("tasbih-history");
            container.innerHTML = "";

            if (tasbihHistory.length === 0) {
                const emptyMessage = document.createElement("p");
                emptyMessage.className = "text-center text-gray-500 py-4";
                emptyMessage.textContent = "No history yet";
                container.appendChild(emptyMessage);
                return;
            }

            tasbihHistory.forEach((item) => {
                const historyItem = document.createElement("div");
                historyItem.className =
                    "flex justify-between items-center py-3 border-b border-gray-100";

                const dateDhikr = document.createElement("div");
                dateDhikr.className = "flex items-center";

                const date = document.createElement("span");
                date.className = "font-medium text-gray-700 mr-2";
                date.textContent = item.date;

                const dhikr = document.createElement("span");
                dhikr.className =
                    "text-sm bg-gray-100 px-2 py-1 rounded-full text-gray-600";
                dhikr.textContent = item.dhikr;

                dateDhikr.appendChild(date);
                dateDhikr.appendChild(dhikr);

                const count = document.createElement("span");
                count.className = "font-bold text-gray-800";
                count.textContent = item.count;

                historyItem.appendChild(dateDhikr);
                historyItem.appendChild(count);
                container.appendChild(historyItem);
            });
        }

        // Profile functions
        function loadUserProfile() {
            document.getElementById("profile-name").textContent = userData.name;
            document.getElementById("member-since").textContent =
                userData.memberSince;
            document.getElementById("profile-name-input").value = userData.name;
            document.getElementById("profile-email-input").value = userData.email;

            // Set location dropdowns
            document.getElementById("country-select").value =
                userData.location.country;
            document.getElementById("city-input").value = userData.location.city;
            document.getElementById("method-select").value =
                userData.location.method;

            // Set notification toggles
            document.getElementById("prayer-notifications-toggle").checked =
                userData.notifications.prayer;
            document.getElementById("reminder-notifications-toggle").checked =
                userData.notifications.reminder;
            document.getElementById("friday-notifications-toggle").checked =
                userData.notifications.friday;

            // Set dark mode and language
            document.getElementById("dark-mode-toggle").checked = userData.darkMode;
            document.getElementById("language-select").value = userData.language;
        }

        function showEditProfileModal() {
            showModal("edit-profile-modal");
        }

        function saveProfile() {
            const name = document.getElementById("profile-name-input").value.trim();
            const email = document
                .getElementById("profile-email-input")
                .value.trim();

            if (!name) {
                alert("Please enter your name");
                return;
            }

            userData.name = name;
            userData.email = email;

            document.getElementById("profile-name").textContent = name;
            closeModal("edit-profile-modal");
        }

        // Location settings
        function showLocationSettings() {
            showModal("location-settings-modal");
        }

        function saveLocationSettings() {
            const country = document.getElementById("country-select").value;
            const city = document.getElementById("city-input").value.trim();
            const method = document.getElementById("method-select").value;

            if (!country || !city) {
                alert("Please select country and enter city");
                return;
            }

            userData.location = {
                country: country,
                city: city,
                method: method,
            };

            // Update prayer location display
            document.getElementById(
                "prayer-location"
            ).textContent = `${city}, ${getCountryName(country)}`;

            // Reload prayer times (in a real app, this would fetch new times from API)
            loadPrayerTimes();
            loadDetailedPrayerTimes();

            closeModal("location-settings-modal");
        }

        // Get country name from code
        function getCountryName(code) {
            const countries = {
                US: "United States",
                GB: "United Kingdom",
                SA: "Saudi Arabia",
                AE: "UAE",
                PK: "Pakistan",
                IN: "India",
                MY: "Malaysia",
                ID: "Indonesia",
            };
            return countries[code] || code;
        }

        // Notification settings
        function showNotificationSettings() {
            showModal("notification-settings-modal");
        }

        function saveNotificationSettings() {
            userData.notifications = {
                prayer: document.getElementById("prayer-notifications-toggle")
                    .checked,
                reminder: document.getElementById("reminder-notifications-toggle")
                    .checked,
                friday: document.getElementById("friday-notifications-toggle")
                    .checked,
            };

            closeModal("notification-settings-modal");
        }

        // About app
        function showAboutApp() {
            showModal("about-app-modal");
        }

        // Logout
        function logout() {
            if (confirm("Are you sure you want to logout?")) {
                alert("Logged out successfully");
                // In a real app, this would redirect to login page
            }
        }

        // Load user preferences from localStorage
        function loadUserPreferences() {
            const savedUserData = localStorage.getItem("userData");
            if (savedUserData) {
                userData = JSON.parse(savedUserData);
                loadUserProfile();
            }

            // Apply dark mode if enabled
            if (userData.darkMode) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        }

        // Save user preferences to localStorage
        function saveUserPreferences() {
            localStorage.setItem("userData", JSON.stringify(userData));
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove("hidden");
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add("hidden");
        }

        // Event listeners for preferences
        document
            .getElementById("dark-mode-toggle")
            .addEventListener("change", function () {
                userData.darkMode = this.checked;
                if (this.checked) {
                    document.documentElement.classList.add("dark");
                } else {
                    document.documentElement.classList.remove("dark");
                }
                saveUserPreferences();
            });

        document
            .getElementById("language-select")
            .addEventListener("change", function () {
                userData.language = this.value;
                saveUserPreferences();
                // In a real app, this would reload the page with new language
                alert("Language changed. App will reload with new language.");
            });

        // Dua search functionality
        document
            .getElementById("dua-search")
            .addEventListener("input", function () {
                const searchTerm = this.value.toLowerCase();
                const activeCategory = document.querySelector(
                    '[id$="-duas"]:not(.hidden)'
                ).id;

                if (activeCategory === "all-duas") {
                    searchAllDuas(searchTerm);
                } else if (activeCategory === "favorite-duas") {
                    searchFavoriteDuas(searchTerm);
                } else if (activeCategory === "custom-duas") {
                    searchCustomDuas(searchTerm);
                }
            });

        function searchAllDuas(searchTerm) {
            const container = document.getElementById("all-duas");
            container.innerHTML = "";

            const filteredDuas = duas.filter(
                (dua) =>
                    dua.title.toLowerCase().includes(searchTerm) ||
                    dua.content.toLowerCase().includes(searchTerm)
            );

            if (filteredDuas.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.className = "text-center py-8 text-gray-500";
                emptyMessage.innerHTML =
                    '<i class="fas fa-search text-3xl mb-2 text-gray-300"></i><p>No duas found</p>';
                container.appendChild(emptyMessage);
                return;
            }

            filteredDuas.forEach((dua) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 rounded-lg shadow-sm text-left dua-button flex justify-between items-center bg-cover bg-center relative overflow-hidden";
                duaButton.onclick = () => showDuaDetail(dua.id);

                // Set background image
                if (dua.image) {
                    duaButton.style.backgroundImage = `url('${dua.image}')`;
                } else {
                    duaButton.classList.add("bg-white"); // fallback background if no image
                }

                // Optional: add a dark overlay to improve text readability
                const overlay = document.createElement("div");
                overlay.className = "absolute inset-0 bg-black bg-opacity-40";
                duaButton.appendChild(overlay);

                // Text content (on top of image)
                const contentWrapper = document.createElement("div");
                contentWrapper.className =
                    "relative z-10 flex justify-between w-full items-center";

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-semibold text-white";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-white";

                contentWrapper.appendChild(duaTitle);
                contentWrapper.appendChild(icon);
                duaButton.appendChild(contentWrapper);
                container.appendChild(duaButton);
            });
        }

        function searchFavoriteDuas(searchTerm) {
            const container = document.getElementById("favorite-duas");
            container.innerHTML = "";

            const filteredDuas = duas.filter(
                (dua) =>
                    dua.isFavorite &&
                    (dua.title.toLowerCase().includes(searchTerm) ||
                        dua.content.toLowerCase().includes(searchTerm))
            );

            if (filteredDuas.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.className = "text-center py-8 text-gray-500";
                emptyMessage.innerHTML =
                    '<i class="fas fa-search text-3xl mb-2 text-gray-300"></i><p>No favorite duas found</p>';
                container.appendChild(emptyMessage);
                return;
            }

            filteredDuas.forEach((dua) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 bg-white rounded-lg shadow-sm text-left dua-button flex justify-between items-center";
                duaButton.onclick = () => showDuaDetail(dua.id);

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-medium text-gray-800";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-gray-400";

                duaButton.appendChild(duaTitle);
                duaButton.appendChild(icon);
                container.appendChild(duaButton);
            });
        }

        function searchCustomDuas(searchTerm) {
            const container = document.getElementById("custom-duas-list");
            container.innerHTML = "";

            const filteredDuas = customDuas.filter(
                (dua) =>
                    dua.title.toLowerCase().includes(searchTerm) ||
                    dua.content.toLowerCase().includes(searchTerm)
            );

            if (filteredDuas.length === 0) {
                const emptyMessage = document.createElement("div");
                emptyMessage.className = "text-center py-8 text-gray-500";
                emptyMessage.innerHTML =
                    '<i class="fas fa-search text-3xl mb-2 text-gray-300"></i><p>No custom duas found</p>';
                container.appendChild(emptyMessage);
                return;
            }

            filteredDuas.forEach((dua, index) => {
                const duaButton = document.createElement("button");
                duaButton.className =
                    "w-full p-4 bg-white rounded-lg shadow-sm text-left dua-button flex justify-between items-center mt-3";
                duaButton.onclick = () => showCustomDuaDetail(index);

                const duaTitle = document.createElement("span");
                duaTitle.className = "font-medium text-gray-800";
                duaTitle.textContent = dua.title;

                const icon = document.createElement("i");
                icon.className = "fas fa-chevron-right text-gray-400";

                duaButton.appendChild(duaTitle);
                duaButton.appendChild(icon);
                container.appendChild(duaButton);
            });
        }
    </script>
</body>

</html>
